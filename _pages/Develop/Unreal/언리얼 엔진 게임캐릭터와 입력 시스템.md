---
title: "[Unreal] 언리얼 엔진 게임캐릭터와 입력 시스템"
date: "2024-6-31"
thumbnail: "/assets/img/unreal.jpg"
---

# [Unreal] 언리얼 엔진 게임캐릭터와 입력 시스템

- 언리얼 게임 콘텐츠 구조

| 게임 |  기믹  | 플레이어 |  폰  | 데이터 | 인공지능 |
| :--: | :----: | :------: | :--: | :----: | :------: |
| 월드 | 트리거 |   입력   | 이동 |  에셋  |  길찾기  |
| 모드 |  스폰  |  카메라  | 모션 | 테이블 |    BT    |
| 상태 |  물리  |   HUD    | 액션 |  설정  |          |
|      |        |   상태   | 위젯 |  저장  |          |

## 액터의 구조

- 월드에 속한 콘텐츠의 기본 단위를 액터라고 함.
- 액터는 트랜스폼을 가지며, 월드로부터 틱과 시간 서비스를 제공받는다.
- 사실 액터는 논리적 개념일 뿐 컴포넌트를 감싸는 포장 박스에 불과함.
- 실질적인 구현은 컴포넌트가 진행하고, 액터는 다수의 컴포넌트를 소유하고 있음.
- 다수의 컴포넌트를 대표하는 컴포넌트를 루트 컴포넌트(Root Component)라고 함.
- 액터는 루트 컴포넌트를 가져야 하며, 루트 컴포넌트의 트랜스폼은 액터의 트랜스폼을 의미함.



## C++ 액터에서 컴포넌트 생성

- 컴포넌트는 언리얼 오브젝트이므로 UPROPERTY를 설정하고 TObjectPtr로 포인터를 선언한다.
  - 언리얼 5버전부터 헤더에 언리얼 오브젝트를 선언할 떄 일반 포인터에서 TObjectPtr로 변경
- 컴포넌트의 등록
  - CDO에서 생성한 컴포넌트는 자동으로 월드에 등록된다.
  - NewObject로 생성한 컴포넌트는 반드시 등록절차를 거쳐야 한다.(Register Component)
  - 등록된 컴포넌트는 월드의 기능을 사용할 수 있으며, 물리와 렌더링 처리에 합류한다.
- 컴포넌트의 확장 설계
  - 에디터 편집 및 블루프린트로의 승계를 위한 설정
  - UPROPERTY에 지정자(Specifier)를 설정할 수 있다.
- 컴포넌트 지정자
  - Visible / Edit : 크게 객체타입과 값타입으로 사용
  - Anywhere / DefaultsOnly / InstanceOnly : 에디터에서 편집 가능 영역
  - BlueprintReadOnly / BlueprintReadWrite : 블루프린트로 확장시 읽기 혹은 읽기쓰기 권한을 부여
  - Category : 에디터 편집 영역(Detail)에서의 카테고리 지정



## 폰의 기능과 설계

- 폰은 액터를 상속받은 특별한 액터이며, 플레이어가 빙의해 입출력을 처리하도록 설계되어 있음.
- 폰은 길찾기를 사용할 수 있으며, 일반적으로 세 가지 주요 컴포넌트로 구성됨.
  - 기믹과 상호작용을 담당하는 출돌 컴포넌트 (루트 컴포넌트)
  - 시각적인 비주얼을 담당하는 메시 컴포넌트
  - 움직임을 담당하는 컴포넌트
- 컴포넌트 중에서 트랜스폼이 없이 기능만 제공하는 컴포넌트를 액터 컴포넌트라고 함.



## 캐릭터의 기본 구조

- 캐릭터는 인간형 폰을 구성하도록 언리얼이 제공하는 전문 폰 클래스를 의미.
- 캐릭터는 세 가지 주요 컴포넌트로 구성
  - 기믹과 상호작용을 담당하는 캡슐 컴포넌트 (루트 컴포넌트)
    - 캡슐컴포넌트 : 충돌감지, 물리 상호작용
  - 애니메이션 캐릭터를 표현하는 스켈레탈 메시 컴포넌트
  - 캐릭터의 움직임을 담당하는 캐릭터 무브먼트(CharactorMovement) 컴포넌트



## 입력시스템의 동작 방식

- 플레이어의 입력은 컨트롤러를 통해 폰으로 전달됨.
- 입력을 컨트롤러가 처리할 수도, 폰이 처리할 수도 있는데, 일반적으로 폰이 처리하도록 함.



## 항상된 입력시스템(Enhanced Input System)

- 기존 입력시스템을 대체하고 언리얼 5.1부터 새롭게 도입
- 사용자의 입력 설정 변경에 유연하게 대처할 수 있도록 구조를 재수립.
- 사용자 입력 처리를 네 단계로 세분화하고 각 설정을 독립적인 에셋으로 대체.
- **동작 구성**
  - 사용자의 입력 데이터를 최종 함수에 매핑하는 과정을 체계적으로 구성
  - 플랫폼에 따른 다양한 입력 장치의 설정
    - 게임 패드용, 키보드용
  - 입력 값의 변경
    - ADWS 입력값을 Y축과 X축으로 변경, 값 반전의 처리
  - 이벤트 발생 조건의 상세 설정
    - 일반버튼인가? 축 이동인가? 일정 이상 눌러야 하는가?
  - 동작 순서
    - 사용자(사용자 입력)
    - 입력 매핑 컨테스트(입력연결)
    - 액션(입력값 변조 -> 이벤트 활성화)
    - 게임 로직(함수 활성화)